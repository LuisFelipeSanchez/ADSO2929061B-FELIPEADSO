<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ikaruga‑like • HTML único (funcionando)</title>
<style>
  :root{
    --bg1:#0a1124; --bg2:#0f1b38; --hud:#e6f7ff; --accent:#7fffd4;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--hud)}
  #wrap{display:flex;align-items:center;justify-content:center;min-height:100%;padding:16px}
  canvas{border-radius:14px;box-shadow:0 10px 36px rgba(2,6,23,.7);display:block;background:transparent}
  .hud{position:fixed;left:16px;top:16px;user-select:none;text-shadow:0 1px 6px rgba(0,0,0,.5)}
  .hud .t{font-weight:700}
  .hud .s{font-size:13px;opacity:.95}
  .help{position:fixed;right:16px;top:16px;background:rgba(255,255,255,.05);padding:10px 12px;border-radius:10px;font-size:13px;line-height:1.35}
  .center{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,.04);border-radius:12px;padding:16px 18px;backdrop-filter:blur(6px);box-shadow:0 8px 40px rgba(0,0,0,.5);display:none}
  .btn{display:inline-block;margin-top:10px;padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,#2a6bff,#1b4fe6);color:#fff;font-weight:700;text-decoration:none;cursor:pointer}
</style>
</head>
<body>
  <div id="wrap">
    <canvas id="game" width="540" height="960" aria-label="Ikaruga-like"></canvas>
  </div>

  <div class="hud" id="hud">
    <div class="t">Ikaruga‑like • Prototype</div>
    <div class="s" id="score">Puntuación: 0</div>
    <div class="s" id="life">Vida: 5</div>
    <div class="s" id="pol">Polaridad: BLANCO</div>
  </div>

  <div class="help">
    <div><strong>Controles</strong></div>
    <div>WASD / Flechas: mover</div>
    <div>Z o Espacio: disparar</div>
    <div>X: cambiar polaridad</div>
    <div>P: pausa • R: reiniciar</div>
    <div style="opacity:.8;margin-top:6px">Tip: click en el lienzo cambia polaridad</div>
  </div>

  <div class="center" id="overlay"><div id="overlayText" style="font-weight:800;font-size:20px">PAUSADO</div><a id="restart" class="btn" style="display:none">Reiniciar</a></div>

<script>
/* ======================================================
   Ikaruga‑like autocontenido (sin imágenes externas)
   - Polaridad (blanco/negro), absorción de balas del mismo color
   - Oleadas simples de enemigos, patrones radial + dirigido
   - HUD, pausa, reinicio, partículas, parallax
   ====================================================== */

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const HUD = {
  score: document.getElementById('score'),
  life: document.getElementById('life'),
  pol: document.getElementById('pol'),
  overlay: document.getElementById('overlay'),
  overlayText: document.getElementById('overlayText'),
  restart: document.getElementById('restart'),
};

/* HiDPI / DPR scaling para verlo nítido */
(function scaleCanvas(){
  const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  const {width, height} = canvas; // atributos declarados en HTML
  canvas.style.width = width + 'px';
  canvas.style.height = height + 'px';
  canvas.width = Math.floor(width * dpr);
  canvas.height = Math.floor(height * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0); // dibujamos en unidades CSS
})();

/* Entrada */
const keys = {};
addEventListener('keydown', e=>{ const k=e.key.toLowerCase(); keys[k]=true; if([' ','z','x','p','r'].includes(k)) e.preventDefault(); });
addEventListener('keyup', e=>{ keys[e.key.toLowerCase()]=false; });
canvas.addEventListener('click', ()=> togglePolarity());

/* Utilidades */
const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));
const rand  = (a,b)=> Math.random() * (b-a) + a;

/* Estado del juego */
let last=0, dt=0, paused=false, over=false, tAcc=0;
let score=0, life=5;
const POL_WHITE=1, POL_BLACK=-1;

const player = {
  x: canvas.width/2/ (window.devicePixelRatio||1),
  y: 760,
  r: 18,
  speed: 420,
  shootCd: 0.12,
  shootT: 0,
  pol: POL_WHITE
};

const stars = Array.from({length:120}, ()=> ({x:rand(0,canvas.width/(window.devicePixelRatio||1)), y:rand(0,canvas.height/(window.devicePixelRatio||1)), r:rand(0.4,1.6), s:rand(5,32)}));
const bands = Array.from({length:6}, (_,i)=>({y:i*(canvas.height/(window.devicePixelRatio||1)/6), amp:rand(18,48), speed:rand(6,20), off:rand(0,Math.PI*2)}));

const bullets = [];        // del jugador
const enemyBullets = [];   // del enemigo
const enemies = [];
const particles = [];

/* (Opcional) configuración para usar imágenes externas
   Déjalo en false y el juego funciona con gráficos vectoriales.
   Si quieres sprites, pon USE_IMAGES=true y rellena URLs.
*/
const USE_IMAGES = false;
const IMAGES = {
  player: '', enemy: '', bulletWhite: '', bulletBlack: '', background: ''
};
const loadedImgs = {};
if (USE_IMAGES) {
  for (const k in IMAGES) if (IMAGES[k]) {
    const img = new Image(); img.src = IMAGES[k]; loadedImgs[k]=img;
  }
}

/* Entidades */
function spawnEnemyWave(){
  const count = 3 + Math.floor(Math.random()*3);
  for(let i=0;i<count;i++){
    enemies.push({
      x: (canvas.width/(window.devicePixelRatio||1))/(count+1)*(i+1),
      y: -40 - i*20,
      vx: rand(-20,20),
      vy: rand(30,60),
      hp: 3,
      t: 0,
      phase: Math.random(),
      r: 22
    });
  }
}

function addBullet(arr, x,y, vx,vy, pol, owner){
  arr.push({x,y,vx,vy,pol, r:(owner==='player'?6:7), owner});
}

function enemyFire(e){
  // radial pequeño
  const n = 6;
  for(let i=0;i<n;i++){
    const a = i*(Math.PI*2/n) + e.t*0.6;
    const sp = rand(120,180);
    addBullet(enemyBullets, e.x, e.y, Math.cos(a)*sp, Math.sin(a)*sp, Math.random()<0.5?POL_WHITE:POL_BLACK, 'enemy');
  }
  // dirigido
  const ax = player.x - e.x, ay = player.y - e.y;
  const a = Math.atan2(ay,ax);
  addBullet(enemyBullets, e.x, e.y, Math.cos(a)*240, Math.sin(a)*240, Math.random()<0.5?POL_WHITE:POL_BLACK, 'enemy');
}

function burst(x,y,n=16,color='rgba(255,255,255,.9)'){
  for(let i=0;i<n;i++){
    particles.push({x,y, vx:Math.cos(Math.random()*Math.PI*2)*rand(30,220), vy:Math.sin(Math.random()*Math.PI*2)*rand(30,220), life:rand(.6,1.2), t:0, size:rand(1,3), color});
  }
}

/* Lógica principal */
function update(ts){
  if(!last) last = ts; dt = Math.min(.033, (ts - last)/1000); last = ts;
  if(!paused && !over){
    tAcc += dt;

    // movimiento
    let dx=0,dy=0;
    if(keys['a']||keys['arrowleft']) dx=-1;
    if(keys['d']||keys['arrowright']) dx=1;
    if(keys['w']||keys['arrowup']) dy=-1;
    if(keys['s']||keys['arrowdown']) dy=1;
    const len = Math.hypot(dx,dy)||1;
    player.x += (dx/len)*player.speed*dt;
    player.y += (dy/len)*player.speed*dt;
    player.x = clamp(player.x, 24, (canvas.width/(window.devicePixelRatio||1))-24);
    player.y = clamp(player.y, 80, (canvas.height/(window.devicePixelRatio||1))-24);

    // disparo
    player.shootT += dt;
    if((keys['z']||keys[' ']) && player.shootT >= player.shootCd){
      player.shootT = 0;
      addBullet(bullets, player.x-10, player.y-18, 0, -520, player.pol, 'player');
      addBullet(bullets, player.x+10, player.y-18, 0, -520, player.pol, 'player');
      burst(player.x, player.y+8, 6, player.pol===POL_WHITE? 'rgba(220,255,255,.9)':'rgba(120,120,120,.85)');
    }

    // alternar polaridad (antirebote)
    if(keys['x'] && !keys._xPrev){ togglePolarity(); }
    keys._xPrev = keys['x'];

    // spawns
    if(tAcc>2.2){ tAcc=0; spawnEnemyWave(); }

    // enemigos
    for(let i=enemies.length-1;i>=0;i--){
      const e=enemies[i];
      e.t += dt;
      e.x += Math.sin(e.t*1.6 + e.phase)*20*dt + e.vx*dt;
      e.y += e.vy*dt;
      if(e.y > (canvas.height/(window.devicePixelRatio||1))+60) enemies.splice(i,1);
      if(Math.random()<0.006 + 0.004*dt*60) enemyFire(e);
    }

    // balas jugador
    for(let i=bullets.length-1;i>=0;i--){
      const b=bullets[i]; b.x+=b.vx*dt; b.y+=b.vy*dt;
      if(b.y<-30||b.y>(canvas.height/(window.devicePixelRatio||1))+30||b.x<-30||b.x>(canvas.width/(window.devicePixelRatio||1))+30){ bullets.splice(i,1); continue; }
      for(let j=enemies.length-1;j>=0;j--){
        const e=enemies[j];
        if(Math.hypot(b.x-e.x,b.y-e.y) < e.r + b.r){
          e.hp -= 1; bullets.splice(i,1);
          burst(b.x,b.y,8,b.pol===POL_WHITE?'rgba(220,255,255,.9)':'rgba(140,140,140,.9)');
          if(e.hp<=0){ score += 120; burst(e.x,e.y,28,'#ffd58a'); enemies.splice(j,1); }
          else score += 20;
          break;
        }
      }
    }

    // balas enemigas
    for(let i=enemyBullets.length-1;i>=0;i--){
      const b=enemyBullets[i]; b.x+=b.vx*dt; b.y+=b.vy*dt;
      if(b.y<-40||b.y>(canvas.height/(window.devicePixelRatio||1))+40||b.x<-40||b.x>(canvas.width/(window.devicePixelRatio||1))+40){ enemyBullets.splice(i,1); continue; }
      // colisión con jugador
      if(Math.hypot(b.x-player.x,b.y-player.y) < player.r + b.r){
        if(b.pol === player.pol){
          score += 10; burst(b.x,b.y,8,'rgba(200,255,255,.9)');
        } else {
          life -= 1; burst(player.x,player.y,18,'rgba(255,80,80,.9)'); if(life<=0) over=true;
        }
        enemyBullets.splice(i,1);
      }
    }

    // partículas
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i]; p.t+=dt; p.x+=p.vx*dt; p.y+=p.vy*dt; p.vx*=.98; p.vy*=.98; if(p.t>p.life) particles.splice(i,1);
    }

    // puntuación pasiva
    score += dt*2;
  }

  // HUD
  HUD.score.textContent = 'Puntuación: ' + Math.floor(score);
  HUD.life.textContent  = 'Vida: ' + life;
  HUD.pol.textContent   = 'Polaridad: ' + (player.pol===POL_WHITE? 'BLANCO':'NEGRO');

  render();
  requestAnimationFrame(update);
}

function togglePolarity(){
  player.pol *= -1; burst(player.x,player.y,16, player.pol===POL_WHITE? 'rgba(220,255,255,.9)':'rgba(110,110,110,.85)');
}

/* Render */
function render(){
  const W = canvas.width/(window.devicePixelRatio||1), H = canvas.height/(window.devicePixelRatio||1);
  ctx.clearRect(0,0,W,H);

  // bandas de fondo
  for(let i=0;i<bands.length;i++){
    const b=bands[i];
    const y = (b.y + Math.sin((Date.now()/1000)*b.speed + b.off)*b.amp + (i*10)) % (H+200) - 100;
    const g = ctx.createLinearGradient(0,y,0,y+180);
    g.addColorStop(0,'rgba(12,28,44,'+(0.08 + i*0.02)+')');
    g.addColorStop(1,'rgba(6,12,24,'+(0.02 + i*0.01)+')');
    ctx.fillStyle = g; ctx.fillRect(0,y,W,180);
  }

  // estrellas
  ctx.save(); ctx.globalCompositeOperation='lighter';
  for(const s of stars){
    const sx = (s.x + Math.sin(Date.now()/10000*s.s)*6) % W;
    const sy = (s.y + (Date.now()/1000)*(s.s*0.01)) % H;
    ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,'+(0.06 + (s.r/2)*0.18)+')';
    ctx.arc(sx,sy,s.r,0,Math.PI*2); ctx.fill();
  }
  ctx.restore();

  // enemigos
  for(const e of enemies){
    ctx.save(); ctx.translate(e.x, e.y);
    // glow
    ctx.globalCompositeOperation='lighter'; ctx.fillStyle='rgba(255,200,120,.08)';
    ctx.beginPath(); ctx.arc(0,0,e.r*1.8,0,Math.PI*2); ctx.fill();
    ctx.globalCompositeOperation='source-over';
    // cuerpo
    ctx.fillStyle='#ffd58a';
    ctx.beginPath(); ctx.moveTo(-e.r, e.r); ctx.quadraticCurveTo(0, -e.r*1.2, e.r, e.r); ctx.closePath(); ctx.fill();
    // núcleo
    ctx.fillStyle='#ffb84d'; ctx.beginPath(); ctx.arc(0,0,e.r*.6,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }

  // balas enemigas
  for(const b of enemyBullets){
    ctx.beginPath();
    if(b.pol===POL_WHITE){
      ctx.fillStyle='rgba(255,255,255,.95)'; ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.fillStyle='rgba(160,240,255,.85)'; ctx.arc(b.x,b.y,b.r*.55,0,Math.PI*2); ctx.fill();
    } else {
      ctx.fillStyle='rgba(30,30,30,.98)'; ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.fillStyle='rgba(150,150,150,.8)'; ctx.arc(b.x,b.y,b.r*.55,0,Math.PI*2); ctx.fill();
    }
  }

  // jugador
  drawPlayer(player.x, player.y, player.r, player.pol);

  // balas jugador
  for(const b of bullets){
    ctx.beginPath();
    if(b.pol===POL_WHITE){
      const g = ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r*2);
      g.addColorStop(0,'rgba(200,255,255,.98)'); g.addColorStop(1,'rgba(120,200,220,.02)');
      ctx.fillStyle=g; ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
    } else {
      const g = ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r*2);
      g.addColorStop(0,'rgba(120,120,120,.98)'); g.addColorStop(1,'rgba(30,30,30,.02)');
      ctx.fillStyle=g; ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
    }
  }

  // partículas
  for(const p of particles){
    const a = 1 - (p.t / p.life); ctx.globalAlpha = Math.max(0,Math.min(1,a));
    ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
  }

  // viñeta suave
  const vg = ctx.createLinearGradient(0,0,0,H); vg.addColorStop(0,'rgba(0,0,0,.18)'); vg.addColorStop(.6,'rgba(0,0,0,0)'); vg.addColorStop(1,'rgba(0,0,0,.25)');
  ctx.fillStyle=vg; ctx.fillRect(0,0,W,H);

  // overlays
  if(paused || over){
    ctx.save(); ctx.fillStyle='rgba(4,8,14,.6)'; ctx.fillRect(W*.12,H*.36,W*.76,H*.28); ctx.restore();
  }
}

function drawPlayer(x,y,r,pol){
  ctx.save(); ctx.translate(x,y); ctx.rotate(Math.sin(Date.now()/300)*0.06);
  const g = ctx.createLinearGradient(-r,-r,r,r);
  if(pol===POL_WHITE){ g.addColorStop(0,'#ffffff'); g.addColorStop(1,'#c1f7ff'); }
  else { g.addColorStop(0,'#151515'); g.addColorStop(1,'#6e6e6e'); }
  ctx.fillStyle=g; ctx.beginPath(); ctx.moveTo(-r*1.2, r*.8); ctx.quadraticCurveTo(0, -r*1.4, r*1.2, r*.8); ctx.lineTo(0,r*.3); ctx.closePath(); ctx.fill();
  ctx.globalCompositeOperation='lighter'; ctx.beginPath(); ctx.fillStyle= pol===POL_WHITE? 'rgba(200,255,255,.15)':'rgba(120,120,120,.12)'; ctx.arc(0,-r*.1,r*1.05,0,Math.PI*2); ctx.fill(); ctx.globalCompositeOperation='source-over';
  ctx.restore();
}

/* Pausa y reinicio */
addEventListener('keydown', e=>{
  const k=e.key.toLowerCase();
  if(k==='p'){ paused=!paused; HUD.overlay.style.display = paused? 'block':'none'; HUD.overlayText.textContent = 'PAUSADO'; HUD.restart.style.display='none'; }
  if(k==='r' && over){ reset(); }
});
HUD.restart.addEventListener('click', reset);

function reset(){
  bullets.length=0; enemyBullets.length=0; enemies.length=0; particles.length=0;
  score=0; life=5; over=false; paused=false;
  player.x = (canvas.width/(window.devicePixelRatio||1))/2; player.y = 760; player.pol = POL_WHITE;
  HUD.overlay.style.display='none';
}

// comprobación de fin de juego mediante vida
const checkOver = setInterval(()=>{
  if(life<=0 && !over){ over=true; HUD.overlay.style.display='block'; HUD.overlayText.textContent='GAME OVER'; HUD.restart.style.display='inline-block'; }
}, 100);

// generador de disparos extra para enemigos
setInterval(()=>{ if(Math.random()<0.06 && enemies.length){ const e=enemies[Math.floor(Math.random()*enemies.length)]; enemyFire(e); } }, 400);
setInterval(()=>{ for(const e of enemies){ if(Math.random()<0.28) enemyFire(e); } }, 1200);

requestAnimationFrame(update);
</script>
</body>
</html>
